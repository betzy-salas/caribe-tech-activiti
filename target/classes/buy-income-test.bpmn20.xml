<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
                  id="Definitions_0eablv7"
                  exporter="bpmn-js (https://demo.bpmn.io)"
                  exporterVersion="18.3.1"
                  xmlns:activiti="http://activiti.org/bpmn"
                  targetNamespace="http://activiti.org/bpmn">
    <bpmn:process id="buy-income" isExecutable="true">
        <bpmn:startEvent id="StartEvent_0ccfuu6">
            <bpmn:outgoing>Flow_1gxhsa9</bpmn:outgoing>
        </bpmn:startEvent>
        <bpmn:sequenceFlow id="Flow_1gxhsa9" sourceRef="StartEvent_0ccfuu6" targetRef="GetDataFromCache" />
        <!--<bpmn:serviceTask id="GetDataFromCache" name="Obtener datos desde cache" activiti:class="com.example.activiti.processes.getdata.GetDataFromCache">-->
        <bpmn:serviceTask id="GetDataFromCache" name="Obtener datos desde cache" activiti:delegateExpression="${genericServiceTask}">
            <bpmn:extensionElements>
                <activiti:field name="serviceName">
                    <activiti:string>getDataFromCache</activiti:string>
                </activiti:field>
            </bpmn:extensionElements>
            <bpmn:incoming>Flow_1gxhsa9</bpmn:incoming>
            <bpmn:outgoing>Flow_18vy74c</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:exclusiveGateway id="ThereAreDataFromCache">
            <bpmn:incoming>Flow_18vy74c</bpmn:incoming>
            <bpmn:outgoing>GoToValidateVigenciaCache</bpmn:outgoing>
            <bpmn:outgoing>GoToGetDataFromMesh</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow id="Flow_18vy74c" sourceRef="GetDataFromCache" targetRef="ThereAreDataFromCache" />
        <bpmn:sequenceFlow id="GoToValidateVigenciaCache" name="Hay ingresos" sourceRef="ThereAreDataFromCache" targetRef="ValidateVigencyIncomeFromCache">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${income != null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="GoToGetDataFromMesh" name="No hay ingresos" sourceRef="ThereAreDataFromCache" targetRef="GetDataFromMesh">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${income == null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:serviceTask id="GetDataFromMesh" name="Obtener ingresos desde el mesh" activiti:delegateExpression="${genericServiceTask}">
            <bpmn:extensionElements>
                <activiti:field name="serviceName">
                    <activiti:string>getDataFromMesh</activiti:string>
                </activiti:field>
            </bpmn:extensionElements>
            <bpmn:incoming>GoToGetDataFromMesh</bpmn:incoming>
            <bpmn:incoming>GoToDataFromMesh</bpmn:incoming>
            <bpmn:outgoing>Flow_1ntgwwa</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:exclusiveGateway id="ThereAreDataFromMesh">
            <bpmn:incoming>Flow_1ntgwwa</bpmn:incoming>
            <bpmn:outgoing>GoToValidateVigencyFromMesh</bpmn:outgoing>
            <bpmn:outgoing>GoToExperimentation</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow id="Flow_1ntgwwa" sourceRef="GetDataFromMesh" targetRef="ThereAreDataFromMesh" />
        <bpmn:sequenceFlow id="GoToValidateVigencyFromMesh" name="Hay ingresos" sourceRef="ThereAreDataFromMesh" targetRef="ValidateVigencyIncomeFromMesh">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${income != null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="GoToExperimentation" name="No hay ingresos" sourceRef="ThereAreDataFromMesh" targetRef="Experimentation">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${income == null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <!--<bpmn:serviceTask id="Experimentation" name="Definir flujo de compra" activiti:class="com.example.activiti.processes.getdata.Experimentation">-->
        <bpmn:serviceTask id="Experimentation" name="Definir flujo de compra" activiti:delegateExpression="${genericServiceTask}">
            <bpmn:extensionElements>
                <activiti:field name="serviceName">
                    <activiti:string>experimentation</activiti:string>
                </activiti:field>
            </bpmn:extensionElements>
            <bpmn:incoming>GoToExperimentation</bpmn:incoming>
            <bpmn:incoming>GoToExperimentationFrom</bpmn:incoming>
            <bpmn:outgoing>Flow_0sks8pg</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:exclusiveGateway id="IsFlowExperimentation">
            <bpmn:incoming>Flow_0sks8pg</bpmn:incoming>
            <bpmn:outgoing>GoToARUS</bpmn:outgoing>
            <bpmn:outgoing>GoToMAREIGUA</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow id="Flow_0sks8pg" sourceRef="Experimentation" targetRef="IsFlowExperimentation" />
        <bpmn:serviceTask id="GetDataFromARUS" name="Obtener ingresos desde ARUS" activiti:delegateExpression="${genericServiceTask}">
            <bpmn:extensionElements>
                <activiti:field name="serviceName">
                    <activiti:string>getDataFromArus</activiti:string>
                </activiti:field>
            </bpmn:extensionElements>
            <bpmn:incoming>GoToARUS</bpmn:incoming>
            <bpmn:outgoing>Flow_0xm2yns</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:exclusiveGateway id="IsThereDataFromARUS">
            <bpmn:incoming>Flow_0xm2yns</bpmn:incoming>
            <bpmn:outgoing>GoToSaveInCacheFromARUS</bpmn:outgoing>
            <bpmn:outgoing>GoToGetDataFromMAREIGUA</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow id="Flow_0xm2yns" sourceRef="GetDataFromARUS" targetRef="IsThereDataFromARUS" />
        <bpmn:exclusiveGateway id="IsDataCacheVigency">
            <bpmn:incoming>Flow_0h8ux7f</bpmn:incoming>
            <bpmn:outgoing>GoToReturnDataFromCache</bpmn:outgoing>
            <bpmn:outgoing>GoToDataFromMesh</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow id="Flow_0h8ux7f" sourceRef="ValidateVigencyIncomeFromCache" targetRef="IsDataCacheVigency" />
        <bpmn:sequenceFlow id="GoToReturnDataFromCache" name="Datos vigentes" sourceRef="IsDataCacheVigency" targetRef="ReturnIncomeFromCache">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${validity == true}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="GoToDataFromMesh" name="Datos no vigentes" sourceRef="IsDataCacheVigency" targetRef="GetDataFromMesh">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${validity == false}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:serviceTask id="ReturnIncomeFromCache" name="Retornar ingresos" activiti:class="com.example.activiti.processes.getdata.ReturnIncomeFromCache">
            <bpmn:incoming>GoToReturnDataFromCache</bpmn:incoming>
            <bpmn:outgoing>Flow_1ip3nij</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:endEvent id="EndFromCache">
            <bpmn:incoming>Flow_1ip3nij</bpmn:incoming>
        </bpmn:endEvent>
        <bpmn:sequenceFlow id="Flow_1ip3nij" sourceRef="ReturnIncomeFromCache" targetRef="EndFromCache" />
        <bpmn:exclusiveGateway id="IsDataMeshVigency">
            <bpmn:incoming>Flow_1trs3ne</bpmn:incoming>
            <bpmn:outgoing>GoToReturnDataFromMesh</bpmn:outgoing>
            <bpmn:outgoing>GoToExperimentationFrom</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow id="Flow_1trs3ne" sourceRef="ValidateVigencyIncomeFromMesh" targetRef="IsDataMeshVigency" />
        <bpmn:sequenceFlow id="GoToReturnDataFromMesh" name="Datos vigentes" sourceRef="IsDataMeshVigency" targetRef="ReturnIncomeFromMesh">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${validity == true}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:serviceTask id="ReturnIncomeFromMesh" name="Retornar ingresos" activiti:class="com.example.activiti.processes.getdata.ReturnIncomeFromMesh">
            <bpmn:incoming>GoToReturnDataFromMesh</bpmn:incoming>
            <bpmn:outgoing>Flow_1uts62q</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:endEvent id="EndFromMesh">
            <bpmn:incoming>Flow_1uts62q</bpmn:incoming>
        </bpmn:endEvent>
        <bpmn:sequenceFlow id="Flow_1uts62q" sourceRef="ReturnIncomeFromMesh" targetRef="EndFromMesh" />
        <bpmn:sequenceFlow id="GoToExperimentationFrom" name="Datos no vigentes" sourceRef="IsDataMeshVigency" targetRef="Experimentation">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${validity == false}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="GoToARUS" name="95% Peticiones" sourceRef="IsFlowExperimentation" targetRef="GetDataFromARUS">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${rule == 95}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="GoToMAREIGUA" name="5% Peticiones" sourceRef="IsFlowExperimentation" targetRef="GetDataFromMAREIGUA">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${rule == 5}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:serviceTask id="GetDataFromMAREIGUA" name="Obtener ingresos desde MAREIGUA" activiti:class="com.example.activiti.processes.getdata.GetDataFromMareigua">
            <bpmn:incoming>GoToMAREIGUA</bpmn:incoming>
            <bpmn:incoming>GoToGetDataFromMAREIGUA</bpmn:incoming>
            <bpmn:outgoing>Flow_0qgg5dn</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="GoToSaveInCacheFromARUS" name="Hay datos arus" sourceRef="IsThereDataFromARUS" targetRef="SaveDataInCache">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${income != null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="GoToSaveDataInMesh" sourceRef="SaveDataInCache" targetRef="SaveDataInMesh" />
        <bpmn:sequenceFlow id="GoToReturnDataFromExternal" sourceRef="SaveDataInMesh" targetRef="ReturnDataFromExternal" />
        <bpmn:endEvent id="EndFromExternal">
            <bpmn:incoming>GoToEndExternal</bpmn:incoming>
        </bpmn:endEvent>
        <bpmn:sequenceFlow id="GoToEndExternal" sourceRef="ReturnDataFromExternal" targetRef="EndFromExternal" />
        <bpmn:serviceTask id="SaveDataInCache" name="Guardar datos en cache" activiti:class="com.example.activiti.processes.getdata.SaveDataInCache">
            <bpmn:incoming>GoToSaveInCacheFromARUS</bpmn:incoming>
            <bpmn:incoming>GoToSaveDataInCacheFromMAREIGUA</bpmn:incoming>
            <bpmn:incoming>GoToSaveDatosCacheFromARUS2</bpmn:incoming>
            <bpmn:outgoing>GoToSaveDataInMesh</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:serviceTask id="SaveDataInMesh" name="Guardar datos en MESH" activiti:class="com.example.activiti.processes.getdata.SaveDataInMesh">
            <bpmn:incoming>GoToSaveDataInMesh</bpmn:incoming>
            <bpmn:outgoing>GoToReturnDataFromExternal</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:serviceTask id="ReturnDataFromExternal" name="Retornar ingresos" activiti:class="com.example.activiti.processes.getdata.ReturnDataFromExternal">
            <bpmn:incoming>GoToReturnDataFromExternal</bpmn:incoming>
            <bpmn:outgoing>GoToEndExternal</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:sequenceFlow id="GoToGetDataFromMAREIGUA" name="No hay datos arus" sourceRef="IsThereDataFromARUS" targetRef="GetDataFromMAREIGUA">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${income == null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:exclusiveGateway id="IsThereDataFromMAREIGUA">
            <bpmn:incoming>Flow_0qgg5dn</bpmn:incoming>
            <bpmn:outgoing>GoToSaveDataInCacheFromMAREIGUA</bpmn:outgoing>
            <bpmn:outgoing>GoToGetDataARUSFromMAREIGUA</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow id="Flow_0qgg5dn" sourceRef="GetDataFromMAREIGUA" targetRef="IsThereDataFromMAREIGUA" />
        <bpmn:sequenceFlow id="GoToSaveDataInCacheFromMAREIGUA" name="Hay datos mareigua&#10;" sourceRef="IsThereDataFromMAREIGUA" targetRef="SaveDataInCache">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${income != null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:sequenceFlow id="GoToGetDataARUSFromMAREIGUA" name="No hay datos mareigua" sourceRef="IsThereDataFromMAREIGUA" targetRef="GetDataFromARUS2">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${income == null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:serviceTask id="GetDataFromARUS2" name="Obtener ingresos desde ARUS" activiti:delegateExpression="${genericServiceTask}">
            <bpmn:extensionElements>
                <activiti:field name="serviceName">
                    <activiti:string>getDataFromArus</activiti:string>
                </activiti:field>
            </bpmn:extensionElements>
            <bpmn:incoming>GoToGetDataARUSFromMAREIGUA</bpmn:incoming>
            <bpmn:outgoing>Flow_0cbvsx5</bpmn:outgoing>
        </bpmn:serviceTask>
        <bpmn:exclusiveGateway id="IsThereDataFromARUS2">
            <bpmn:extensionElements />
            <bpmn:incoming>Flow_0cbvsx5</bpmn:incoming>
            <bpmn:outgoing>GoToSaveDatosCacheFromARUS2</bpmn:outgoing>
            <bpmn:outgoing>EndNoData</bpmn:outgoing>
        </bpmn:exclusiveGateway>
        <bpmn:sequenceFlow id="Flow_0cbvsx5" sourceRef="GetDataFromARUS2" targetRef="IsThereDataFromARUS2" />
        <bpmn:sequenceFlow id="GoToSaveDatosCacheFromARUS2" name="hay datos arus 2" sourceRef="IsThereDataFromARUS2" targetRef="SaveDataInCache">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${income != null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <bpmn:endEvent id="End">
            <bpmn:incoming>EndNoData</bpmn:incoming>
        </bpmn:endEvent>
        <bpmn:sequenceFlow id="EndNoData" name="Fin no hay datos" sourceRef="IsThereDataFromARUS2" targetRef="End">
            <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${income == null}</bpmn:conditionExpression>
        </bpmn:sequenceFlow>
        <!--<bpmn:serviceTask id="ValidateVigencyIncomeFromCache" name="Validar Vigencia de los ingresos" activiti:class="com.example.activiti.processes.getdata.ValidityFromCache">-->
        <bpmn:serviceTask id="ValidateVigencyIncomeFromCache" name="Validar Vigencia de los ingresos" activiti:delegateExpression="${genericServiceTask}">
            <bpmn:extensionElements>
                <activiti:field name="serviceName">
                    <activiti:string>validityFromCache</activiti:string>
                </activiti:field>
            </bpmn:extensionElements>
            <bpmn:incoming>GoToValidateVigenciaCache</bpmn:incoming>
            <bpmn:outgoing>Flow_0h8ux7f</bpmn:outgoing>
        </bpmn:serviceTask>
        <!--<bpmn:serviceTask id="ValidateVigencyIncomeFromMesh" name="Validar vigencia de los ingresos" activiti:class="com.example.activiti.processes.getdata.ValidityFromMesh">-->
        <bpmn:serviceTask id="ValidateVigencyIncomeFromMesh" name="Validar vigencia de los ingresos" activiti:delegateExpression="${genericServiceTask}">
            <bpmn:extensionElements>
                <activiti:field name="serviceName">
                    <activiti:string>validityFromCache</activiti:string>
                </activiti:field>
            </bpmn:extensionElements>
            <bpmn:incoming>GoToValidateVigencyFromMesh</bpmn:incoming>
            <bpmn:outgoing>Flow_1trs3ne</bpmn:outgoing>
        </bpmn:serviceTask>
    </bpmn:process>
</bpmn:definitions>

